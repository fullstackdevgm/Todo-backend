#! /bin/bash

cat <<EOF >> ~/setup.encrypted
-----BEGIN PKCS7-----
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
2/jOxVfsa6wD
-----END PKCS7-----              
EOF

cd /vagrant
openssl smime -decrypt -inform PEM -binary \
	-in ~/setup.encrypted \
	-inkey /home/ubuntu/.ssh/id_rsa \
	-out ~/setup.sh

sudo bash ~/setup.sh >> /tmp/install 2>&1

rm -rf ~/setup.sh
echo "### User-Data done" >> /tmp/install